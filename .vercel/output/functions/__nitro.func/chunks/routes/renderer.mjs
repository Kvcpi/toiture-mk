import{createRenderer as e,getRequestDependencies as t,getPreloadLinks as n,getPrefetchLinks as r}from"vue-bundle-renderer/runtime";import{j as s,a as o,g as a,b as i,c as d,e as l,f as u,h as c,u as p}from"../_/nitro.mjs";import{createHead as h,propsToString as f,renderSSRHead as m}from"unhead/server";import{walkResolver as y}from"unhead/utils";import{toValue as b,isRef as g,hasInjectionContext as w,inject as _,ref as v,watchEffect as A,getCurrentInstance as x,onBeforeUnmount as C,onDeactivated as R,onActivated as j}from"vue";import{renderToString as S}from"vue/server-renderer";import{stringify as T,uneval as L}from"devalue";import{DeprecationsPlugin as U,PromisesPlugin as k,TemplateParamsPlugin as P,AliasSortingPlugin as $}from"unhead/plugins";const VueResolver=(e,t)=>g(t)?b(t):t,H="usehead";function useHead(e,t={}){const n=t.head||function(){if(w()){const e=_(H);if(!e)throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.");return e}throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.")}();return n.ssr?n.push(e||{},t):function(e,t,n={}){const r=v(!1);let s;A((()=>{const o=r.value?{}:y(t,VueResolver);s?s.patch(o):s=e.push(o,n)}));x()&&(C((()=>{s.dispose()})),R((()=>{r.value=!0})),j((()=>{r.value=!1})));return s}(n,e,t)}function createHead(e={}){const t=h({...e,propResolvers:[VueResolver]});return t.install=function(e){return{install(t){t.config.globalProperties.$unhead=e,t.config.globalProperties.$head=e,t.provide(H,e)}}.install}(t),t}const z={meta:[{name:"viewport",content:"width=device-width, initial-scale=1"},{charset:"utf-8"}],link:[],style:[],script:[],noscript:[]},O={id:"teleports"};function buildAssetsURL(...e){return s(publicAssetsURL(),o().app.buildAssetsDir,...e)}function publicAssetsURL(...e){const t=o().app,n=t.cdnURL||t.baseURL;return e.length?s(n,...e):n}const M=`<div${f({id:"__nuxt"})}>`,N="</div>",getClientManifest=()=>import("../build/client.manifest.mjs").then((e=>e.default||e)).then((e=>"function"==typeof e?e():e)),E=lazyCachedFunction((()=>import("../build/styles.mjs").then((e=>e.default||e)))),F=lazyCachedFunction((async()=>{const t=await getClientManifest();if(!t)throw new Error("client.manifest is not available");const n=await import("../build/server.mjs").then((function(e){return e.s})).then((e=>e.default||e));if(!n)throw new Error("Server bundle is not available");return e(n,{manifest:t,renderToString:async function(e,t){const n=await S(e,t);return M+n+N},buildAssetsURL:buildAssetsURL})})),D=lazyCachedFunction((async()=>{const t=await getClientManifest(),n=await import("../virtual/_virtual_spa-template.mjs").then((e=>e.template)).catch((()=>"")).then((e=>M+e+N)),r=e((()=>()=>{}),{manifest:t,renderToString:()=>n,buildAssetsURL:buildAssetsURL}),s=await r.renderToString({});return{rendererContext:r.rendererContext,renderToString:e=>{const t=o(e.event);return e.modules||=new Set,e.payload.serverRendered=!1,e.config={public:t.public,app:t.app},Promise.resolve(s)}}}));function lazyCachedFunction(e){let t=null;return()=>(null===t&&(t=e().catch((e=>{throw t=null,e}))),t)}function renderPayloadJsonScript(e){const t={type:"application/json",innerHTML:e.data?T(e.data,e.ssrContext._payloadReducers):"","data-nuxt-data":"nuxt-app","data-ssr":!e.ssrContext.noSSR,id:"__NUXT_DATA__"};e.src&&(t["data-src"]=e.src);return[t,{innerHTML:`window.__NUXT__={};window.__NUXT__.config=${L(e.ssrContext.config)}`}]}function splitPayload(e){const{data:t,prerenderedAt:n,...r}=e.payload;return{initial:{...r,prerenderedAt:n},payload:{data:t,prerenderedAt:n}}}const I={disableDefaults:!0,disableCapoSorting:!1,plugins:[U,k,P,$]},X={omitLineBreaks:!1};globalThis.__buildAssetsURL=buildAssetsURL,globalThis.__publicAssetsURL=publicAssetsURL;const q=!!O.id,B=q?`<div${f(O)}>`:"",J=q?"</div>":"",W=/^[^?]*\/_payload.json(?:\?.*)?$/,Y=d((async e=>{const s=p(),d=e.path.startsWith("/__nuxt_error")?l(e):null;if(d&&d.statusCode&&(d.statusCode=Number.parseInt(d.statusCode)),d&&!("__unenv__"in e.node.req))throw u({statusCode:404,statusMessage:"Page Not Found: /__nuxt_error"});const h=void 0;let f=d?.url||e.path;const y=W.test(f);y&&(f=f.substring(0,f.lastIndexOf("/"))||"/",e._path=f,e.node.req.url=f);const b=c(e),g=createHead(I),w={mode:"server"};g.push(z,w);const _={url:f,event:e,runtimeConfig:o(e),noSSR:e.context.nuxt?.noSSR||!1===b.ssr&&!0||!1,head:g,error:!!d,nuxt:void 0,payload:d?{error:d}:{},_payloadReducers:Object.create(null),modules:new Set,islandContext:h},v=_.noSSR?await D():await F();for(const e of await getClientManifest().then((e=>Object.values(e).filter((e=>e._globalCSS)).map((e=>e.src)))))_.modules.add(e);const A=await v.renderToString(_).catch((async e=>{if(_._renderResponse&&"skipping render"===e.message)return{};const t=!d&&_.payload?.error||e;throw await(_.nuxt?.hooks.callHook("app:error",t)),t}));if(await(_.nuxt?.hooks.callHook("app:rendered",{ssrContext:_,renderResult:A})),_._renderResponse)return _._renderResponse;if(_.payload?.error&&!d)throw _.payload.error;if(y){const e=function(e){return{body:T(splitPayload(e).payload,e._payloadReducers),statusCode:i(e.event),statusMessage:a(e.event),headers:{"content-type":"application/json;charset=utf-8","x-powered-by":"Nuxt"}}}(_);return e}const x=await async function(e){const t=await E(),n=new Set;for(const r of e)if(r in t&&t[r])for(const e of await t[r]())n.add(e);return Array.from(n).map((e=>({innerHTML:e})))}(_.modules??[]),C=b.noScripts,{styles:R,scripts:j}=t(_,v.rendererContext);_._preloadManifest&&g.push({link:[{rel:"preload",as:"fetch",fetchpriority:"low",crossorigin:"anonymous",href:buildAssetsURL(`builds/meta/${_.runtimeConfig.app.buildId}.json`)}]},{...w,tagPriority:"low"}),x.length&&g.push({style:x});{const e=[];for(const t of Object.values(R))e.push({rel:"stylesheet",href:v.rendererContext.buildAssetsURL(t.file),crossorigin:""});e.length&&g.push({link:e},w)}C||(g.push({link:n(_,v.rendererContext)},w),g.push({link:r(_,v.rendererContext)},w),g.push({script:renderPayloadJsonScript({ssrContext:_,data:_.payload})},{...w,tagPosition:"bodyClose",tagPriority:"high"})),b.noScripts||g.push({script:Object.values(j).map((e=>({type:e.module?"module":null,src:v.rendererContext.buildAssetsURL(e.file),defer:!e.module||null,tagPosition:"head",crossorigin:""})))},w);const{headTags:S,bodyTags:L,bodyTagsOpen:U,htmlAttrs:k,bodyAttrs:P}=await m(g,X),$={island:false,htmlAttrs:k?[k]:[],head:normalizeChunks([S]),bodyAttrs:P?[P]:[],bodyPrepend:normalizeChunks([U,_.teleports?.body]),body:[A.html,B+(q?joinTags([_.teleports?.[`#${O.id}`]]):"")+J],bodyAppend:[L]};await s.hooks.callHook("render:html",$,{event:e});var H;return{body:(H=$,`<!DOCTYPE html><html${joinAttrs(H.htmlAttrs)}><head>${joinTags(H.head)}</head><body${joinAttrs(H.bodyAttrs)}>${joinTags(H.bodyPrepend)}${joinTags(H.body)}${joinTags(H.bodyAppend)}</body></html>`),statusCode:i(e),statusMessage:a(e),headers:{"content-type":"text/html;charset=utf-8","x-powered-by":"Nuxt"}}}));function normalizeChunks(e){return e.filter(Boolean).map((e=>e.trim()))}function joinTags(e){return e.join("")}function joinAttrs(e){return 0===e.length?"":" "+e.join(" ")}const G=Object.freeze({__proto__:null,default:Y});export{H as h,publicAssetsURL as p,G as r,useHead as u};
//# sourceMappingURL=renderer.mjs.map
